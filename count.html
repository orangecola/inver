<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="d3-cloud-master/build/d3.layout.cloud.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<body>
<script>

var width = 750, height = 500
var countScale = d3.scale.linear().range([10, 60])

var color_domain = [10, 30, 50, 70, 90]
var fill = d3.scale.category20();
var groupId = [];
var color = d3.scale.threshold()
  .domain(color_domain)
  .range(["#ff1300", "#ff4e40", "#ff7d73", "#ffba00", "#ffcb40", "#adfcad"])

d3.csv("SacramentocrimeJanuary2006.csv", function (datasetText) {
	
	var maxId = 0;
	for (var i = 0; i < datasetText.length; i++) {
		var item = datasetText[i];
		
		var exists = false;
		
		for (var z = 0; z < groupId.length; z++) {
			if (groupId[z].date == item.cdatetime) {
					exists = true;
					break;
			}
		}
		
		if (exists) {
			groupId[z].count++;
			groupId[z].objects.push(item);
			}
		else {
			groupId.push({date : item.cdatetime, count : 1, objects: []})
			groupId[(groupId.length-1)].objects.push(item)
		}
	}
		var leaders = groupId
	.map(function(d) {return { text: d.date, size: d.count, count:d.count, data: d, sentiment: Math.floor(Math.random() * 100)};})
	.sort(function(a, b) {return d3.descending(a.size, b.size);})
	.slice(0,150)
	console.log(leaders)
	
	countScale.domain([d3.min(leaders, function(d) {return d.size;}), d3.max(leaders, function(d){return d.size;})])
	d3.layout.cloud().size([width, height])
	.words(leaders)
	.padding(0)
	//.rotate(function() {return ~~(Math.random() * 2); })
	.font("Impact")
	.fontSize(function(d) {return countScale(d.size);})
	.on("end", draw)
	.start();
})
		
function draw(words) {
    d3.select("body").insert("svg", ":first-child")
        .attr("width", width)
        .attr("height", height)
      .append("g")
        .attr("transform", "translate("+ (width/2) + "," + (height/2) + ")")
      .selectAll("text")
        .data(words)
      .enter().append("text")
        .style("font-size", function(d) { return d.size + "px"; })
        .style("font-family", "Impact")
        .style("fill", function(d, i) { return color(d.sentiment); })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.text; })
		.on("click", function(d) {$("#data").html("<h1>Time:" + d.text + "</h1><h2>Amount: " + d.count + "</h2><h3>Sentiment:" + d.sentiment + "</h3>" + "<p>" + iteminfo(d.data.objects) + "</p>")});
  }
  
function iteminfo(data) {
	var string = ""
	for (var i=0; i < data.length; i++) {
		//console.log(data[i])
		string += JSON.stringify(data[i]) + "<br>"
	}
	return string
} 
</script>
<div id="data"></div>
</body>