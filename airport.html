<!doctype html>

<html lang="en">
	
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="A portfolio template that uses Material Design Lite.">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
		<title>MDL-Static Website</title>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
		<link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.grey-pink.min.css" />
		<link rel="stylesheet" href="css/index.css" />
		
		
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		
		<style>
			html, body { height: 100%; padding: 0; margin: 0; width: 100%; }
			
			.box {
				border-width:1px;
				border-style:solid;
				float:left;
				width: 50%;
				height: 50%;
				-webkit-box-sixing: border-box;
				-moz-box-sizing: border-box; 
				box-sizing: border-box;
				overflow:hidden;
			}
			
			.bar {
			fill: steelblue;
			}
			
			.bar:hover {
			fill: brown;
			}
			
			.axis {
			font: 10px sans-serif;
			}
			
			.axis path,
			.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
			}
			
			.axis path,
			.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
			}
			
			.x.axis path {
			display: none;
			}
			
			.line {
			fill: none;
			stroke: green;
			stroke-width: 1.5px;
			}
			
			
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	</head>
	
	<body>
		<div id="div1" class="box">
			<div class="mdl-card__title">
				<h2 class="mdl-card__title-text">Visitor Arrivals Over The Past 15 Years</h2>
			</div>
		</div>
		<div id="div3" class="box">
				<div class="mdl-card__title">
				<!--<h2 class="mdl-card__title-text">Events happening</h2>-->
				</div>
				
				<div class="mdl-card__supporting-text">
					The line graph on the left shows the monthly visitor arrivals for the past 15 years.
				</div>
	
		</div>
		<div id="div2" class="box">
			<div class="mdl-card__title">
				<h2 class="mdl-card__title-text">Visitor Arrival Details By Year </h2>
			</div>
			<select id = "year" name = "year">
				<option value="">Please Select</option>
			</select>
		</div>
		<div id="div4" class="box">
			<div class="mdl-card__title">
			</div>
			<div class="mdl-card__supporting-text">
				The bar graph on the left shows the detailed monthly arrivals of a specific year.
			</div>
		</div>
		
		<script type="text/javascript">
			
			
			
			
			var margin = {top: 20, right: 20, bottom: 50, left: 60},
			width = $("#div2").width() - margin.left - margin.right,
			height = $("#div2").height() - $("#div2 > div > h2").height() - 40 - $("#div2 > select").height() - margin.top - margin.bottom;
			
			console.log($("#div2").height() - $("#div2 > div > h2").height())
			
			var color = d3.scale.category20();
			
			var formatmonth = d3.time.format("%Y-%m");
			var groupId = [];
			var x = d3.time.scale()
			.range([0, width]);
			
			var y = d3.scale.linear()
			.range([height, 0]);
			
			var xAxis = d3.svg.axis()
			.scale(x)
			.orient("bottom");
			
			var yAxis = d3.svg.axis()
			.scale(y)
			.orient("left");
			
			var line = d3.svg.line()
			.x(function(d) { return x(d.month); })
			.y(function(d) { return y(d.total_international_visitor_arrivals); });
			
			var svg = d3.select("#div1").append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			
			
			
			
			d3.csv("datasets/total-visitor-international-arrivals-monthly.csv", type, function(error, data) {
				
				console.log(data)
				x.domain(d3.extent(data, function(d) { return d.month; }));
				y.domain(d3.extent(data, function(d) { return d.total_international_visitor_arrivals; }));
				
				
				
				svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);
				
				svg.append("g")
				.attr("class", "y axis")
				.call(yAxis)
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("Total International Visitor Arrivals");
				
				var path = svg.append("path")
				.datum(data)
				.attr("class", "line")
				.attr("d", line);

				var totalLength = path.node().getTotalLength();

				path
				  .attr("stroke-dasharray", totalLength + " " + totalLength)
				  .attr("stroke-dashoffset", totalLength)
				  .transition()
					.duration(3000)
					.ease("linear")
					.attr("stroke-dashoffset", 0);
				
				year = data.unique().sort(function(a, b){return b.month.getFullYear()-a.month.getFullYear()});
				
				console.log(year)
				
				for (var i=0; i < year.length; i++){
				$("#year").append("<option value = '" + year[i].month.getFullYear() + "'>" + year[i].month.getFullYear() + "</option>")
				}
				
				
				
				$(function() {
					$("#year").on("change",function() {
						if (this.value != "")
						displayData(data, this.value)
					}); 
				});
			});
			
			
			function displayData(data, year) {
			
				var words = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				$("#div2 > svg").remove()
				data = data.filter(function(d) { return d.month.getFullYear() == year })
				  .sort(function(a, b) {return d3.ascending(a.month, b.month);})
				  .map(function(d, i) {return {month:words[i], total_international_visitor_arrivals : d.total_international_visitor_arrivals};})
				var margin = {top: 20, right: 20, bottom: 60, left: 60}
				var width = $("#div2").width() - margin.left - margin.right
				var height = $("#div2").height() - $("#div2 > .mdl-card__title").height()- $('#year').height()  - margin.top - margin.bottom;
				
				console.log(data)
				var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
				
				var y = d3.scale.linear().range([height, 0])
				
				var xAxis = d3.svg.axis()
				  .scale(x)
				  .orient("bottom");
				
				var yAxis = d3.svg.axis()
				  .scale(y)
				  .orient("left")
				  //.ticks(10, "%");
				  
				var svg = d3.select("#div2").append("svg")
				  .attr("width", width + margin.left + margin.right)
				  .attr("height", height + margin.top + margin.bottom)
				.append("g")
				  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				  
				x.domain(data.map(function(d) {return d.month;}));
				y.domain([0, d3.max(data, function(d) { return d.total_international_visitor_arrivals;})]);
				
				svg.append("g")
				  .attr("class", "x axis")
				  .attr("transform", "translate(0," + height + ")")
				  .call(xAxis);
				
				svg.append("g")
				  .attr("class", "y axis")
				  .call(yAxis)
				  
				svg.selectAll(".bar")
				  .data(data)
				.enter().append("rect")
				  .attr("class", "bar")
				  .attr("x", function(d) { return x(d.month); })
				  .attr("width", x.rangeBand())
				  .attr("fill", function(d) { return color(d)})
				  .attr("y", function (d, i) {
					  return height;
				  })
				  .attr("height", 0)
					.transition()
					.duration(200)
					.delay(function (d, i) {
						return i * 50;
					})
				  .attr("y", function(d, i) { return height - y(d.total_international_visitor_arrivals); })
				  .attr("height", function(d) { return y(d.total_international_visitor_arrivals); });
				
			}
			
			function type(d) {
				d.month = formatmonth.parse(d.month);
				d.total_international_visitor_arrivals = +d.total_international_visitor_arrivals;
				return d;
			}
			
			Array.prototype.contains = function(v) {
				for(var i = 0; i < this.length; i++) {
					if(this[i].month.getFullYear() === v.month.getFullYear()) return true;
				}
				return false;
			};
			
			Array.prototype.unique = function() {
				var arr = [];
				for(var i = 0; i < this.length; i++) {
					if(!arr.contains(this[i])) {
						arr.push(this[i]);
					}
				}
				return arr; 
			}
			
		</script>	
		<script src="https://code.getmdl.io/1.1.3/material.min.js"></script>
	</body>
	
</html>
